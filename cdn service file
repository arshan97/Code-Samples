#!/bin/bash

LOG_FILE="/app/CDNDashboard/cdn.log"
PID_FILE="/app/CDNDashboard/cdn.pid"

case $1 in
  start)
    echo "Starting CDN Service"
    cd /app/CDNDashboard || exit
    NODE_ENV=production /app/CDNDashboard/node_modules/node/bin/node /app/CDNDashboard/server.js >> "$LOG_FILE" 2>&1 &
    echo $! > "$PID_FILE"
    echo "Service started with PID $(cat $PID_FILE)"
    ;;
  
  stop)
    echo "Stopping CDN Service"
    if [ -f "$PID_FILE" ]; then
      PID=$(cat "$PID_FILE")
      if kill -0 "$PID" 2>/dev/null; then
        kill "$PID"
        rm "$PID_FILE"
        echo "Service stopped"
      else
        echo "Process not found"
      fi
    else
      echo "Service not running"
    fi
    ;;
  
  restart)
    $0 stop
    sleep 1
    $0 start
    ;;
  
  *)
    echo "No valid parameter provided. Use: start | stop | restart"
    ;;
esac